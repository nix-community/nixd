<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nixd: libnixf Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">nixd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="dir_9ff0e04ed484c0229c3bd8fc4cfe4cb8.html">libnixf</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">libnixf Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for libnixf:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="dir_9ff0e04ed484c0229c3bd8fc4cfe4cb8_dep.svg" width="258" height="158"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:include" id="r_include"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_2ea7252d21588581e550b8cc37b5f8d9.html">include</a></td></tr>
<tr class="memitem:src" id="r_src"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_464f141540dd1f7c0b8c2d5e8b32798f.html">src</a></td></tr>
<tr class="memitem:tools" id="r_tools"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_9e27054b909c25724b28a0b7e56ac908.html">tools</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
`libnixf`, The nix frontend</h1>
<p>This constitutes a frontend for the Nix language, encompassing a lexer, parser, and semantic analysis, with a prime emphasis on enhancing the editing experience.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Background &amp; Motivation</h1>
<p>Over the years, the Nix community has seen a variety of parsers developed by different hackers, however, not all of them are suitable for editing purposes. For example, the official parser, generated by yacc, consists of declarative files (with some grammar rules included). Yacc-generated parsers prioritize speed but can lack robust error handling capabilities. Consequently, when editing files within your workspace, which may be incomplete and riddled with errors, this deficiency becomes apparent. The need for a new Nix parser arises from challenges in implementing robust error recovery and providing helpful error hints.</p>
<p>For instance, addressing error recovery regarding missing semicolons:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    a = 1</div>
<div class="line">    b = 2</div>
<div class="line">}</div>
</div><!-- fragment --><p>The official parser will complain there are some errors happens in the <em>second</em> eq sign <span class="tt">=</span>, not the first one:</p>
<div class="fragment"><div class="line">nix-repl&gt; {</div>
<div class="line">              a = 1</div>
<div class="line">              b = 2</div>
<div class="line">error: syntax error, unexpected &#39;=&#39;, expecting &#39;;&#39;</div>
<div class="line">       at Â«stringÂ»:3:7:</div>
<div class="line">            2|     a = 1</div>
<div class="line">            3|     b = 2</div>
<div class="line">             |       ^</div>
</div><!-- fragment --><p>But we actually know the error happens right after "1", right?</p>
<p>The second challenge is, the offical nix parser stops right after the first error token encountered. However for language servers, you may want to see it is going on parsing, recovered from previous errors.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Modules</h1>
<p>Currently the package has these following components.</p>
<ul>
<li>Basic (<a class="el" href="namespaceDiagnostic.html">Diagnostic</a> Types, Node Types, ...)</li>
<li>Parse (The parsing algorithm implementation)</li>
<li>Sema (Semantic Analysis, e.g. duplicated keys)</li>
<li>Bytecode (experimental)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
The <span class="tt">Basic</span> module</h1>
<p>This module mainly exposing nixf interfaces, and it's definitions are shared among other modules.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
<span class="tt">Diagnostic</span> and Fixes</h2>
<p>A <span class="tt"><a class="el" href="namespaceDiagnostic.html">Diagnostic</a></span> have a set of <span class="tt">Note</span>s attached to it. And each diagnostic has a set of fixes. Each fix has a name briefly describe the plan. For example</p>
<ul>
<li>"insert ;"</li>
<li>"remove ...".</li>
</ul>
<p>And each fix has a series of <span class="tt">Edit</span>s. The removing range, and the new text to replace it.</p>
<p>These "fixes" could be applied automatically, and also may pop a "ðŸ’¡" and let you choose that fix.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
AST Nodes</h2>
<p>Each node in the AST is owned by its parent and becomes immutable immediately after construction.</p>
<p>Additionally, the libnixf AST incorporates semantic information, which is populated by Semantic Actions within the Sema module.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
The <span class="tt">Parse</span> module</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
The parsing algorithm</h2>
<p>This is a recursive descent parser not completely consistent with the official one in case of error recovery.</p>
<p>The objective is twofold:</p>
<ol type="1">
<li>Ensure a consistent experience when code can be accurately evaluated.</li>
<li>Offer a significantly improved experience when code cannot be correctly evaluated.</li>
</ol>
<p>For instance, the following text will undergo different parsing outcomes in libnixf.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    a = 1  # &lt;-- look at here</div>
<div class="line">    b = 2;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the official Nix parser, it would be parses as <span class="tt">a = (Call 1, b)</span> for the <span class="tt">a</span> attribute. So you will see the strange diagnostic: </p><div class="fragment"><div class="line">nix-repl&gt; {</div>
<div class="line">              a = 1</div>
<div class="line">              b = 2</div>
<div class="line">error: syntax error, unexpected &#39;=&#39;, expecting &#39;;&#39;</div>
<div class="line">       at Â«stringÂ»:3:7:</div>
<div class="line">            2|     a = 1</div>
<div class="line">            3|     b = 2</div>
<div class="line">             |       ^</div>
</div><!-- fragment --><p>However, in the libnixf parser, since <span class="tt">1</span> will definitely not be evaluated as a lambda, it will not be called. Thus, the result would be:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    a = 1  # &lt;-- missing semicolon &quot;;&quot;</div>
<div class="line">    b = 2; # Correctly parse this as &quot;b = 2&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Standalone tools provided along libnixf</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
<span class="tt">nixf-tidy</span></h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Usage</h3>
<div class="fragment"><div class="line">nixf-tidy</div>
<div class="line"> </div>
<div class="line">--pretty-print  Pretty print the JSON data</div>
<div class="line">--variable-lookup  Peform Variable Lookup Analysis on the source code, including detecting dead code, and unused variables.</div>
</div><!-- fragment --><p>Basic CLI usage:</p>
<div class="fragment"><div class="line">cat foo.nix | nixf-tidy --variable-lookup</div>
</div><!-- fragment --><p> A dedicated tool tailored for linting Nix projects, <span class="tt">nixf-tidy</span> is crafted specifically for seamless integration into CI pipelines like GitHub Actions or commit hooks. As such, it prioritizes functionality over flashy CLI output. Tasks such as rendering code lines or applying color distinctions are beyond the scope of <span class="tt">nixf-tidy</span>.</p>
<p>The JSON fields provided by nixf-tidy are documented <a href="https://nix-community.github.io/nixd/classnixf_1_1Diagnostic.html">here</a>.</p>
<h4 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Use <span class="tt">nixf-tidy</span> in your workflow</h4>
<p>Please update this section if you want to take fancy "rendering" job for libnixf, and link your projects! </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
